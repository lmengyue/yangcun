<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=9" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
		<title>阳村</title>
		<link rel="stylesheet" type="text/css" href="../css/reset.css?5" />
		<link rel="stylesheet" type="text/css" href="../css/head-footer.css" media="screen" />
		<link rel="stylesheet" type="text/css" href="../css/order.css" />
		<link rel="stylesheet" type="text/css" href="../components/bootstrap/css/bootstrap.min.css" />

		<style type="text/css">
			body {
				font-family: Microsoft YaHei;
			}
		</style>
	</head>

	<body>

		<div class="navbar-head" id="toTop">
			<div class="container">
				<div class="row">
					<a href="../index.html" target="_parent" class="col-xs-5 logo-img">
						<img src="../img/index/logo_1.png" />
					</a>
					<div class="col-xs-7 nav-head">
						<div class="row login-ok">
							<div class="col-xs-12">
								<span class="name">
									<span>liumengyu</span> 您好！
								</span>
								<!--<span class="upgrade">
									<a href="" target="_parent" >升级为高级会员</a>
								</span>-->
								<span class="personal">
									<a href="" target="_parent" >我的个人中心</a>
								</span>
								<span class="tt">|</span>
								<span class="out">
									<a href="" target="_parent">退出</a>
								</span>
								<span class="order">
									<a href="" target="_parent">查看我的订单</a>
								</span>
							</div>
							<div class="nav-ul">
								<ul class="col-xs-12 nav-li">
									<li class="offset">
										<a href="../index.html" target="_parent">首页</a>
									</li>
									<li>
										<a href="activ.html" target="_parent">走进阳村</a>
									</li>
									<li class="active">
										<a href="booking.html" target="_parent">民宿预订</a>
									</li>
									<li>
										<a href="gift.html" target="_parent">伴手选礼</a>
									</li>
									<li>
										<a href="news.html" target="_parent">新闻资讯</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="order-box">
			<div class="container order">
				<div class="row">
					<div class="col-xs-12 order-head">
						<ul>
							<li class="active">
								1.订单填写
								<span></span>
							</li>
							<li>2.订单确认
								<span></span>
							</li>
							<li>
								3.订单支付
								<span></span>
							</li>
							<li>
								4.订单完成

							</li>
						</ul>
					</div>

					<div class="col-xs-12 order-body">
						<div class="tiaokuan">
							<h4>预订须知</h4>
							<p>
								1.在预订开始前，请仔细阅读本须知，产品页面中的产品备注也做为协议的补充内容。当您开始预订度假产品时，已表明您仔细阅读并接受协议的所有条款。

							</p>
							<p>
								预订提前期与付款期：为保证度假产品预订，所有国内度假产品请提前3天以上预订并付清已订产品所有款项。您在3天内提交的预订请求，我们会尽力满足您的需要，但对操作结果不做任何承诺。

							</p>
							<p>
								2.关于度假产品的行程推荐仅为友情提示，不能作为约定条款。

							</p>
							<p>
								我们保留在不事先知会的情况下更改其网站上已公布的度假产品价格的权利。您预订的度假产品价格，以确认订单上约定的金额为准。
							</p>

							<p>
								确认订单上约定的价格，不包含您的个人消费、航空人身意外保险费及您应自行投保的其它保险费用等。
							</p>

							<p>3.只有您及时付清确认的应付费用，或及时提供认可的经济担保后，确认的订单方会生效。如您未按要求及时付清相关费用，而此时产品的价格、内容或标准等发生变化，我们对此将不承担任何责任。
							</p>
							<p>
								订单生效后，您若需要更改该订单内的任何项目，请务必在度假活动开始前通知您的更改需求。我们会尽量满足您的需求，但您必须全额承担因变更带来的损失及可能增加的费用。
							</p>
							<p>4.在您按要求付清度假费用或订金后，如因供应商原因，致使您的度假不能成行或内容发生改变的，我们将立即通知您，无条件退返您已支付的所有费用。
							</p>
							<p>
								或在经您同意后，调整产品中的行程内容或接待标准，退还差额费用。如调整后的产品价格高于原来价格，您须补足多出的差额。
							</p>
							<hr />
							<h4>退款政策：</h4>
							<p>
								变更：请至少提前4个工作日与我们联系变更，视酒店房态安排。 退订：请至少提前4个工作日告知我们，否则不予退款，请谅解。 节假日期间入住的订单不予退订。
							</p>

						</div>

						<div class="order-xinxi">
							<div class="yuding">
								<!--<h4>预订中心</h4>
								<label class="minsu-name">民宿名称：
								<b>无锡鸣珂里酒店</b>
								</label>
								<label class="minsu-name">房型：
								<b>大床房</b>
								</label>
								<label>入住日期：
								<span>2017-7-20</span>
								</label>
								<label>离店日期：
							     <span>2017-7-21</span>
								</label>
								<b class="jw">共<span class="jw-span">1</span>晚</b>
								<label>房间数量：
									<select>
									  <option value="1">1</option>
									  <option value="2">2</option>
									  <option value="3">3</option>
									  <option value="4">4</option>
									  <option value="5">5</option>
									</select>
								</label>
								<ul class="money-list">
									<li>
										<h5>2017-08-11(周五)</h5>
										<p>会员价 488元</p>
										<p>早饭：双早</p>
									</li>
									<li>
										<h5>2017-08-12(周六)</h5>
										<p>会员价 588元</p>
										<p>早饭：双早</p>
									</li>
								</ul>
								<i>总费用：<span>￥1178</span></i>-->
							</div>
							<div class="ruzhu">
								<h4>入住人信息</h4>
								<form action="" method="post">
									<label class="name"><i>*</i>姓名：<input type="" value="" placeholder="请输入您的姓名" class="ruzhu-name" required/> <input id="userid" type="hidden" value="18115"/><b class="name-show">（姓名不能为空）</b></label>
									<label class="tel"><i>*</i>联系电话：<input type="" value="" placeholder="请输入您的手机"  class="ruzhu-tel" required/><b class="tel-show">（手机不能为空）</b></label>
									<label class="email">电子邮件：<input type="" value="" placeholder="请输入您的邮箱" class="ruzhu-email" required/><b class="email-show">（邮箱书写有误）</b></label>
									<label class="time"><i>*</i>到店时间：
										<i class="zui-zao">最早到店时间</i>
								    	<select class="arrive-zhao">
									 <option value="">-请选择-</option>
									  <option value="14">14:00</option>
									  <option value="15">15:00</option>
									  <option value="16">16:00</option>
									  <option value="17">17:00</option>
									  <option value="18">18:00</option>
									  <option value="19">19:00</option>
									  <option value="20">20:00</option>
									  <option value="21">21:00</option>
									  <option value="22">22:00</option>
									  <option value="23">23:00</option>
									    <option value="24">23:59</option>
									</select>
									最晚到店时间
									<select class="arrive-wan">
								      <option value="">-请选择-</option>
									  <option value="14">14:00</option>
									  <option value="15">15:00</option>
									  <option value="16">16:00</option>
									  <option value="17">17:00</option>
									  <option value="18">18:00</option>
									  <option value="19">19:00</option>
									  <option value="20">20:00</option>
									  <option value="21">21:00</option>
									  <option value="22">22:00</option>
									  <option value="23">23:00</option>
									</select>
									<b class="time-show"></b>
									</label>
									<label class="time-shuoming">最早到店与最晚到店的时间跨度不得超过3小时</label>
									<label class="luiy"><span>备注：</span><textarea class="text-sm"></textarea></label>
									<label class="check"><input type="checkbox" name="" id="check" value="" />我已阅读左侧条款，并同意<b class="check-show">（请仔细阅读左侧的条款，并选中!）</b></label>
								</form>

								<a href="JavaScript:void(0)" id="form-a">订单提交</a>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>

		<div class="foot">
			<div class="footer-row">
				<table>
					<tr>
						<th>关于我们</th>
						<th>阳村招商</th>
						<th>常见问题</th>
						<th>合作伙伴</th>
					</tr>
					<tr>
						<td>
							<a href="about-contact.html" target="_parent">联系我们</a>
						</td>
						<td>
							<a href="zhaoshang.html" target="_parent">招商政策</a>
						</td>
						<td>
							<a href="yuding.html" target="_parent">预订流程</a>
						</td>
						<td>
							<a href="">旅游情报</a>
						</td>
					</tr>

					<tr>
						<td>
							<a href="about.html" target="_parent">公司简介</a>
						</td>
						<td>
							<a href="zhaoshang-login.html" target="_parent">在线报名</a>
						</td>
						<td>
							<a href="problem.html" target="_parent">Q&A</a>
						</td>
						<td>

						</td>
					</tr>

				</table>

				<div class="contact ">
					<span class="tel"></span>
					<span>咨询电话<br />40000-96828</span>
					<img src="../img/index/jthomt_13.jpg" />
				</div>
			</div>
			<hr/>
			<p class="text-center">CopyRight&nbsp;&copy;&nbsp;上海智汇乡创旅游发展有限公司 沪ICP备13045608号-1</p>
		</div>
	</body>
	<script src="../components/jQuery/jquery-1.12.4.min.js" type="text/javascript"></script>
	<!--<script src="../components/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>-->
	<!--<script src="../components/bootstrap/js/html5shiv.js" type="text/javascript"></script>-->
	<script src="../components/bootstrap/js/respond.js" type="text/javascript"></script>
	<script src="../components/placeholder/jquery.placeholder.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		var house = '';
		$(function() {
			//导航
			$('.nav-li li').click(function() {
				$(this).addClass('active').siblings().removeClass('active');
			})

			//获取导航www地址
			var url = document.location.search;
			//			console.log(url);
			var tmparray = url.substr(1, url.length).split("&");
			console.log(tmparray);
			var paramsArray = new Array;
			for(var i = 0; i < tmparray.length; i++) {
				var reg = /[=|^==]/; // 用=进行拆分，但不包括==
				var set1 = tmparray[i].replace(reg, '&');
				var tmpStr2 = set1.split('&');
				var array = new Array;
				array[tmpStr2[0]] = tmpStr2[1];
				paramsArray.push(array);
			}
			//从地址栏获取的开始结束时间 
			var comedate = paramsArray[0].start_date;
			var leavedate = paramsArray[1].end_date;
			var hotelid = paramsArray[2].hotelid;
			var fx_id = paramsArray[3].fx_id;
			var total = 0;
			$.ajax({
				url: 'http://www.yangvillage.com/action/getdata.php?type=2&hotelid=' + hotelid + '&comedate=' + comedate + '&leavedate=' + leavedate + '&fx_id=' + fx_id + '', // 跳转到 action
				data: {},
				type: 'get',
				async: false,
				dataType: 'text',
				success: function(data) {
					var fxtype = eval(data);
					console.log(fxtype);
					var yudingbox = "";
					for(var i = 0; i < fxtype.length; i++) {
						house = fxtype[i].fx_jg_string;
						yudingbox += "<h4>预定中心</h4>";
						yudingbox += "<label class='minsu-name'>民宿名称：<b>" + fxtype[i].jd_name + "</b></label>";
						yudingbox += "<label class='fx_type'>房型：<b id='fxtype'>" + fxtype[i].fx_jg_string[i].fx_name + "</b></label>";
						yudingbox += "<label class='minsu-name'>入住日期：<span>" + comedate + "</span></label>";
						yudingbox += "<label class='fx_type'>离店日期：<span>" + leavedate + "</span></label>";
						yudingbox += "<b class='jw'>共<span class='jw-span'></span>晚</b>";
						yudingbox += "<label><a href='/order/hotel.php?jd_id=" + hotelid + "'>修改日期</a></label>";
						yudingbox += "<label>房间数：<select id='sel'>";
						for(var m = 1; m <= house[0].fx_sl; m++) {
							yudingbox += "<option value=" + m + ">" + m + "</option>";
						}
						yudingbox += "</select></label>";
						yudingbox += "<ul class='money-list'>";
						for(var j = 0; j < house.length; j++) {
							//总价格
							total += parseInt(house[j].fx_jg);
							//算出礼拜几
							var arys1 = new Array();
							arys1 = house[j].fx_rzrq.split('-');
							var ssdate = new Date(arys1[0], parseInt(arys1[1] - 1), arys1[2]);
							var week1 = String(ssdate.getDay()).replace("0", "日").replace("1", "一").replace("2", "二").replace("3", "三").replace("4", "四").replace("5", "五").replace("6", "六");
							var week = "(周" + week1 + ")";
							//输出li
							yudingbox += "<li class='li-list'><h5>" + house[j].fx_rzrq + week + "</h5><p>" + house[j].fx_jg_name + house[j].fx_jg + "元</p><p>早饭:" + house[j].fx_zc + "</p></li>";
							//							console.log(house[j].fx_jg);
						}
						yudingbox += "</ul>";
						yudingbox += "<i>总费用：<span>￥</span><span class='z-jg'>" + total + "</span></i>";
					}
					$(".yuding").html(yudingbox);
				},
				error: function(data) {
					// view("异常！");
					if(data.status == "404") {
						alert("文件不存在!");
					} else if(data.status == "500") {
						alert("文件编译错误!");
					} else {
						alert("系统错误!");
					}
				}

			});

			//获取option的val 房间数来算出总价格
			$('#sel').change(function() {
				var sel = $('#sel');
				var fj = sel.val();

				$('.z-jg').html(fj * total);
			})

			//获取开始时间结束时间的差  来计算多少晚
			function DateDiff(sDate1, sDate2) { //sDate1和sDate2是2002-12-18格式  
				var aDate, oDate1, oDate2, iDays;
				aDate = sDate1.split("-");
				oDate1 = new Date(aDate[1] + '-' + aDate[2] + '-' + aDate[0]) //转换为12-18-2002格式  
				aDate = sDate2.split("-")
				oDate2 = new Date(aDate[1] + '-' + aDate[2] + '-' + aDate[0])
				iDays = parseInt(Math.abs(oDate1 - oDate2) / 1000 / 60 / 60 / 24) //把相差的毫秒数转换为天数  
				return iDays;
			}

			$('.jw-span').html(DateDiff(paramsArray[0].start_date, paramsArray[1].end_date));
		})

		//提交表单验证
		//名字
		$('.ruzhu-name').blur(function() {
			if($('.ruzhu-name').val() == "") {
				$('.name-show').show();
				$('.ruzhu-name').css("border", "1px solid #c8a063");
				$('.ruzhu-name').focus();
				return false;
			} else {
				$('.name-show').hide();
				return true;
			}
		})
		//电话
		$('.ruzhu-tel').blur(function() {
			var tel = $('.ruzhu-tel').val();
			if(/^1[3|4|5|7|8]\d{9}$/.test(tel)) {
				$('.tel-show').hide();
				return true;

			} else if(tel == "") {
				$('.tel-show').show();
				$('.tel-show').html('(手机号不能为空)');
				return false;
			} else {
				$('.ruzhu-tel').css("border", "1px solid #c8a063");
				$('.tel-show').show();
				$('.tel-show').html('(手机号格式错误)');
				return false;
			}
		})

		//邮箱
		$('.ruzhu-email').blur(function() {
			var email = $('.ruzhu-email').val();
			if($('.ruzhu-email').val() == "") {
				return true;
			} else if(!email.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)) {
				$('.ruzhu-email').css("border", "1px solid #c8a063");
				$('.email-show').show();
				$('.email-show').html('(邮箱格式错误)');
				return false;
			} else {
				$('.email-show').hide();
				return true;

			}

		})
		//早晚到店时间
		$('.arrive-zhao').change(function() {
			var arriveZhao = parseInt($(this).val());
			var arriveWan = '<option>-请选择-</option>';
			for(var i = arriveZhao; i <= arriveZhao + 3; i++) {
				if(i > 23) {
					arriveWan += '<option value="' + i + '">' + (i - 1) + ':59</option>';
					break;
				}
				arriveWan += '<option value="' + i + '">' + i + ':00</option>';
			}
			$('.arrive-wan').html(arriveWan);

		})

		//d点击提交订单
		$('#form-a').click(function() {
			if($('.ruzhu-name').val() == "") {
				$('.name-show').show();
				return false;
			}
			if(!/^1[3|4|5|7|8]\d{9}$/.test($('.ruzhu-tel').val())){
				$('.tel-show').show();
				$('.tel-show').html('(手机号格式不正确)');
				return false;
			}
			if($('.arrive-zhao').val() == "" || $('.arrive-wan').val() == "") {
				$('.time-show').show();
				$('.time-show').html('(请选择时间)');
				return false;
			} else {
				$('.time-show').hide();
			}
			if($("#check[type='checkbox']").is(':checked') == false) {
				$('.check-show').show();
				return false;
			} else {
				$('.check-show').hide();
				return true;
			}

			//再次获取地址栏  为下面的传参数做准备
			var url = document.location.search;
			//			console.log(url);
			var tmparray = url.substr(1, url.length).split("&");
			console.log(tmparray);
			var paramsArray = new Array;
			for(var i = 0; i < tmparray.length; i++) {
				var reg = /[=|^==]/; // 用=进行拆分，但不包括==
				var set1 = tmparray[i].replace(reg, '&');
				var tmpStr2 = set1.split('&');
				var array = new Array;
				array[tmpStr2[0]] = tmpStr2[1];
				paramsArray.push(array);
			}
			//从地址栏获取的开始结束时间 
			var comedate = paramsArray[0].start_date;
			var leavedate = paramsArray[1].end_date;
			var hotelid = paramsArray[2].hotelid;
			var fx_id = paramsArray[3].fx_id;

			if(confirm("确认提交订单吗？")) {
				window.location.href = "order-ok.html";
				console.log(house)
				var houseDetail = '【';
				for(var m = 0; m < house.length; m++) {
					var arys1 = new Array();
					arys1 = house[m].fx_rzrq.split('-');
					var ssdate = new Date(arys1[0], parseInt(arys1[1] - 1), arys1[2]);
					var week1 = String(ssdate.getDay()).replace("0", "日").replace("1", "一").replace("2", "二").replace("3", "三").replace("4", "四").replace("5", "五").replace("6", "六");
					var week = "(周" + week1 + ") ";
					houseDetail += house[m].fx_rzrq + week + house[m].fx_jg + '元 ' + house[m].fx_zc + ';';
				}
				houseDetail += '】';
				$.ajax({
					type: "post",
					url: "http://www1.yangvillage.com/members/personal/myorderinfo/order_submit_action.php",
					data: {
						hotel_id: hotelid,
						fx_id: fx_id,
						rzrq: comedate,
						drq: leavedate,
						zz: $('.arrive-zhao').val(),
						zw: $('.arrive-wan').val(),
						sp_num: $('#sel').val(),
						ws: $('.jw-span').html(),
						total_zje: $('.z-jg').html(),
						lxr: $('.ruzhu-name').val(),
						mobile: $('.ruzhu-tel').val(),
						email: $('.ruzhu-email').val(),
						user_id: $('#userid').val(),
						tssm: $('.text-sm').val(),
						miaoshu: '共计入住 :' + $('.jw-span').html() + '晚 ' + $('#sel').val() + '间' + $('#fxtype').html() + houseDetail,
					},
					async: true,
					dataType: 'json',
					success: function(res, data) {
						console.log(res)
						console.log(data)
						if(data == 'success') {
							window.location.href = "order-ok.html";
						}
						if(data.status == "404") {
							alert("返回数据没找到!");
						} else if(data.status == "500") {
							alert("返回数据编译错误!");
						} else {
							alert("错误!");
						}
					},
					error: function(res, data) {
						console.log('fail')
					},
				});
			}

		})
	</script>

</html>